syntax = "proto3";

package data;

import "google/protobuf/struct.proto";
import "data/geo/enum.proto";

// // // //

message EditorPoint2DObj {
  double x = 1;
  double y = 2;
}

message EditorPolylineObj {
  repeated EditorPoint2DObj points = 1;
  bool closed = 2;
}

message EditorBezierObj {
  repeated EditorPoint2DObj control_points = 1;

  bool closed = 2;
  uint32 segments = 3;
}

message EditorArcObj {
  EditorPoint2DObj center = 1;
  double radius = 2;
  double start_angle_rad = 3;
  double end_angle_rad = 4;
  bool ccw = 5;
}

message EditorLinkObj {
  string a_uid = 1;
  string b_uid = 2;
  EditorLinkType type = 3;
  google.protobuf.Struct props = 4;
}

message EditorLayerStateObj {
  string layer_id = 1;
  bool visible = 2;
  bool locked = 3;
  int32 z_index = 4;
}

message EditorGroupObj {
  string group_uid = 1;
  string name = 2;
  repeated string member_uids = 3;
  google.protobuf.Struct props = 4;
}

message EditorRoadModelObj {
  string target_uid = 1;
  EditorPolylineObj centerline = 2;
  double width = 3;
  bool closed = 4;
  google.protobuf.Struct props = 5;
}

message EditorShapeModelObj {
  string target_uid = 1;

  oneof model {
    EditorPolylineObj polyline = 2;
    EditorBezierObj bezier = 3;
    EditorArcObj arc = 4;
  }

  google.protobuf.Struct props = 10;
}

message EditorSnapNodeObj {
  string node_uid = 1;
  EditorPoint2DObj pos = 2;
  repeated string incident_uids = 3;
  google.protobuf.Struct props = 4;
}

message EditorConstraintObj {
  string constraint_uid = 1;
  EditorConstraintType type = 2;
  repeated string target_uids = 3;
  google.protobuf.Struct params = 4;
}

message EditorPayloadObj {
  uint32 payload_rev = 1;
  EditorCoordSpaceType coord_space = 2;

  repeated EditorLayerStateObj layers = 10;
  repeated EditorGroupObj groups = 11;
  repeated EditorLinkObj links = 12;

  repeated EditorRoadModelObj road_models = 20;
  repeated EditorShapeModelObj shape_models = 21;

  repeated EditorSnapNodeObj snap_nodes = 30;
  repeated EditorConstraintObj constraints = 31;

  google.protobuf.Struct props = 40;
}
